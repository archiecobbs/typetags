<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (17) -->
<title>TypeTag (TypeTags 1.0.0 API)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="description" content="declaration: package: org.dellroad.typetag.core, annotation type: TypeTag">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/TypeTag.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
</div>
<div class="sub-nav">
<div>
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation-interface-optional-element-summary">Optional</a>&nbsp;|&nbsp;</li>
<li>Required</li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation-interface-element-detail">Element</a></li>
</ul>
</div>
<div class="nav-list-search"><label for="search-input">SEARCH:</label>
<input type="text" id="search-input" value="search" disabled="disabled">
<input type="reset" id="reset-button" value="reset" disabled="disabled">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.dellroad.typetag.core</a></div>
<h1 title="Annotation Interface TypeTag" class="title">Annotation Interface TypeTag</h1>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="annotations"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Documented.html" title="class or interface in java.lang.annotation" class="external-link">@Documented</a>
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Retention.html" title="class or interface in java.lang.annotation" class="external-link">@Retention</a>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/RetentionPolicy.html#RUNTIME" title="class or interface in java.lang.annotation" class="external-link">RUNTIME</a>)
<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/Target.html" title="class or interface in java.lang.annotation" class="external-link">@Target</a>(<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/ElementType.html#ANNOTATION_TYPE" title="class or interface in java.lang.annotation" class="external-link">ANNOTATION_TYPE</a>)
</span><span class="modifiers">public @interface </span><span class="element-name type-name-label">TypeTag</span></div>
<div class="block">Meta-annotation for type annotations that can be validated at compile time and runtime by TypeTags.

 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/prism.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/components/prism-java.min.js"></script>
 <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/themes/prism.min.css" rel="stylesheet"/>

 <p>
 The <code>org.dellroad.typetag.checker.TypeTagChecker</code> plug-in to the Checker framework recognizes such annotations
 at compile time and checks for invalid assignments. The <a href="TypeTags.html" title="class in org.dellroad.typetag.core"><code>TypeTags</code></a> utility class provides support for runtime
 checking (see below).

 <p>
 In the descriptions below, the "target annotation" is the annotation to which this meta-annotation is applied.
 The target annotation, also known as a "TypeTag", is some annotation that is applied to Java types and which
 represents the assertion that some predicate is true of any value assigned to the corresponding field, parameter,
 or variable.

 <p>
 The <a href="TypeTag.html" title="annotation interface in org.dellroad.typetag.core"><code>@TypeTag</code></a> meta-annotation defines how, at runtime, those assertion(s) are verified. For example:

 <pre><code class="language-java">
  &#47;**
   * Annotates declarations of type {&#64;link String} for which
   * the value must be non-null and a valid E.164 phone number.
   *
   * &lt;p&gt;
   * Optionally, a North American Numbering Plan (NANP) number
   * may be required.
   *&#47;
  &#64;Retention(RetentionPolicy.RUNTIME)
  &#64;Target(ElementType.TYPE_USE)
  &#64;TypeTag(appliesTo = String.class, validatedBy = PhoneNumberChecker.class)
  public &#64;interface PhoneNumber {

      &#47;**
       * Determine whether North American Numbering Plan (NANP) numbers are required.
       *
       * &#64;return true if only NANP numbers are valid
       *&#47;
      boolean nanpOnly() default false;
  }

  // Validator for the &#64;PhoneNumber annotation
  public static class PhoneNumberChecker implements AnnotationValidator&lt;PhoneNumber&gt; {

      // E.164 format
      private static final String PATTERN = "\\+[1-9][0-9]{6,14}";

      // North American Numbering Plan (NANP) numbers
      private static final String NANP_PATTERN = "\\+1[2-9][0-9]{2}[2-9][0-9]{6}";

      &#64;Override
      public &lt;T&gt; T validate(PhoneNumber spec, T value) {

          // Value must not be null
          if (value == null)
              throw new InvalidValueException("phone number can't be null");

          // We may assume String here because of &#64;TypeTag.appliesTo()
          final String string = (String)value;

          // Check for proper format
          if (!string.matches(PhoneNumber.PATTERN))
              throw new InvalidValueException("not a valid E.164 phone number");

          // Optionally, require number to be North American
          if (spec.nanpOnly() &amp;&amp; !string.matches(PhoneNumber.NANP_PATTERN))
              throw new InvalidValueException("not a North American phone number");

          // OK
          return value;
      }
  }
 </code></pre>

 <p>
 At compile time, the checker verifies the type restriction:

 <pre><code class="language-java">
  String input = scanner.nextLine();
  &#64;PhoneNumber String pn = input;     // error: type restriction not satisfied
 </code></pre>

 <p>
 At runtime, the annotation can be supplied to <a href="TypeTags.html#getValidator(java.lang.annotation.Annotation)"><code>TypeTags.getValidator()</code></a> to build
 a runtime validator. Unfortunately, this requires a bit of reflection gymnastics:

 <pre><code class="language-java">
  &#47;**
   * Verify that the string is valid E.164 phone number.
   *
   * &#64;param string the value to validate
   * &#64;return string
   * &#64;throws InvalidValueException if string is invalid
   *&#47;
  public &#64;PhoneNumber String validatePhoneNumber(String string) {

      // Get the annotation (in a real application this would be cached)
      PhoneNumber spec;
      try {
          spec = (PhoneNumber)this.getClass()
            .getMethod("validatePhoneNumber", String.class)
            .getAnnotatedReturnType()
            .getAnnotations()[0]);
      } catch (ReflectiveOperationException e) {
          throw new RuntimeException("unexpected error", e);
      }

      // Build a Validator from the annotation and validate the value
      return TypeTags.getValidator(spec).apply(string);
  }
 </code></pre>

 <p>
 Now we can ensure both compile-time and runtime correctness as follows:

 <pre><code class="language-java">
  String input = scanner.nextLine();
  &#64;PhoneNumber String pn = validatePhoneNumber(input);    // ok! we're safe
 </code></pre></div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== ANNOTATION INTERFACE OPTIONAL MEMBER SUMMARY =========== -->
<li>
<section class="member-summary" id="annotation-interface-optional-element-summary">
<h2>Optional Element Summary</h2>
<div class="caption"><span>Optional Elements</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Optional Element</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html" title="class or interface in java.lang" class="external-link">Class</a>&lt;?&gt;</code></div>
<div class="col-second even-row-color"><code><a href="#appliesTo()" class="member-name-link">appliesTo</a></code></div>
<div class="col-last even-row-color">
<div class="block">Restrict valid values to the specified type.</div>
</div>
<div class="col-first odd-row-color"><code><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html" title="class or interface in java.lang" class="external-link">Class</a>&lt;? extends <a href="AnnotationValidator.html" title="interface in org.dellroad.typetag.core">AnnotationValidator</a>&gt;</code></div>
<div class="col-second odd-row-color"><code><a href="#validatedBy()" class="member-name-link">validatedBy</a></code></div>
<div class="col-last odd-row-color">
<div class="block">Restrict valid values to those that are accepted by instances of the specified class.</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details" id="annotation-interface-element-detail">
<ul class="details-list">
<!-- ============ ANNOTATION INTERFACE MEMBER DETAIL =========== -->
<li>
<section class="member-details">
<h2>Element Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="appliesTo()">
<h3>appliesTo</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html" title="class or interface in java.lang" class="external-link">Class</a>&lt;?&gt;</span>&nbsp;<span class="element-name">appliesTo</span></div>
<div class="block">Restrict valid values to the specified type.

 <p>
 If this property is set, then any values that are not assignable to the specified type are
 considered invalid. In particular, they should be immediately rejected and not passed to the
 validator specified by <a href="#validatedBy()"><code>validatedBy()</code></a>, if any.

 <p>
 Primitive types should not be used here; they may cause an exception to be thrown.
 Instead, use the corresponding wrapper type (and check for nulls separately, if needed).

 <p>
 To not restrict this annotation by type, leave this property set to its default value.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>supertype of all valid values</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd>java.lang.Object.class</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="validatedBy()">
<h3>validatedBy</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html" title="class or interface in java.lang" class="external-link">Class</a>&lt;? extends <a href="AnnotationValidator.html" title="interface in org.dellroad.typetag.core">AnnotationValidator</a>&gt;</span>&nbsp;<span class="element-name">validatedBy</span></div>
<div class="block">Restrict valid values to those that are accepted by instances of the specified class.

 <p>
 The class must have a public default constructor.

 <p>
 If no additional validation is required beyond <a href="#appliesTo()"><code>appliesTo()</code></a>, leave this property
 set to its default value.</div>
<dl class="notes">
<dt>Returns:</dt>
<dd>annotation-based validation class</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd>org.dellroad.typetag.core.AnnotationValidator.class</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small>Copyright &#169; 2025. All rights reserved.</small></p>
</footer>
</div>
</div>
</body>
</html>
